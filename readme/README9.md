### CSRF

<img width="600" src="https://github.com/user-attachments/assets/14a85371-249d-41d5-9674-a1774c4681fb">

1. 사용자가 쇼핑몰에 로그인
2. 쇼핑몰로 부터 세션 쿠키 발급 받음
3. 공격자가 사용자 이메일로 링크 전달
4. 사용자 링크 클릭
5. 공격자 웹 페이지에는 이미지가 존재
6. 해당 이미지는 쇼핑몰의 링크와 공격자 주소가 파라미터로 있음
7. 쇼핑몰은 자신이 발급한 쿠키가 있는지 확인
8. 쇼핑몰이 발급한 쿠키를 가지고 있으므로 정상적인 요청으로 판단하여 응답
9. 사용자의 의도와 상관없이 공격자에 의해 공격자 배송지가 사용자 계정에 등록됨

<aside>

💡 **이처럼 사용자의 의도와는 무관하게 공격자가 심어 놓은 코드로 인해서 공격자가 의도한 요청 및 응답을 받는 공격 기법을 **`사이트 간 요청 위조`** 라고 한다**

</aside>

### CsrfFilter

- 모든 요청에 랜덤하게 토큰을 생성하여 클라이언트에게 발급
- 이후 클라이언트가 서버에 접속하기 위해서는 서버가 발급한 토큰을 반드시 가져와야 한다
- 요청 시 전달되는 토큰 값과 서버에 저장된 실제 값과 비교한 후 만약 일치하지 않으면 요청 실패
- 클라이언트
  - <input type=”hidden” name=”${_csrf.parameterName}” value=”${_csrf.token}”/>
  - HTTP 메소드 : PATCH, POST, PUT, DELETE 와 같은 메소드로 요청할 때는 반드시 서버에서 발급한 csrf 토큰 값 가지고 요청해야 한다
  - 위와 같이 파라미터 또는 헤더에 토큰을 실어 보내어 인증 가능
- Spring Security
  - `http.csrf()` : 기본 활성화되어 있음
  - `http.csrf().disabled()` : 비활성화
- csrf 기능은 별도의 설정이 없어도 시큐리티가 기본적으로 설정하고 있어 사용가능
